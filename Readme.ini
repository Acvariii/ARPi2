# ARPi2 - Augmented Reality Board Game System

A gesture-controlled board game system using computer vision for hand tracking. Currently features Monopoly with support for up to 8 players using hand gestures captured by a Raspberry Pi camera.

## Features

- **Hand Tracking**: Real-time hand detection and finger tracking using MediaPipe
- **Gesture Control**: Hover-based interactions - hold your finger over buttons to activate them
- **Multi-player Support**: Up to 8 players can play simultaneously
- **Video Display**: Live camera feed with hand tracking overlays
- **Network Architecture**: Distributed system with camera client, server, and game launcher

## System Requirements

### Server PC (runs game and processes hand tracking)
- Python 3.8+
- OpenCV (`opencv-python`)
- MediaPipe
- Pygame
- Websockets
- NumPy

### Raspberry Pi (camera client)
- Raspberry Pi 3/4/5 with camera module
- Python 3.8+
- OpenCV (`opencv-python`)
- Websockets
- NumPy

## Installation

### On Server PC (Windows/Linux/Mac)

```bash
# Clone the repository
git clone <repository-url>
cd ARPi2

# Install dependencies
pip install opencv-python mediapipe pygame websockets numpy
```

### On Raspberry Pi

```bash
# Clone the repository
git clone <repository-url>
cd ARPi2

# Install dependencies
pip install opencv-python websockets numpy

# Enable camera interface
sudo raspi-config
# Navigate to: Interface Options -> Camera -> Enable
```

## Configuration

Before running, update the IP address in the following files to match your server PC's IP:

1. **server.py** (line ~184):
   ```python
   async with websockets.serve(handler, "YOUR_SERVER_IP", 8765, ...):
   ```

2. **pi_client.py** (line ~9):
   ```python
   SERVER_WS = "ws://YOUR_SERVER_IP:8765"
   ```

3. **hand_tracking.py** (line ~8):
   ```python
   def __init__(self, server_ws: str = "ws://YOUR_SERVER_IP:8765"):
   ```

4. **launcher.py** (line ~11):
   ```python
   SERVER_WS = "ws://YOUR_SERVER_IP:8765"
   ```

5. **video_display.py** (line ~9):
   ```python
   def __init__(self, server_ws: str = "ws://YOUR_SERVER_IP:8765", ...):
   ```

**Note**: Replace `YOUR_SERVER_IP` with your server's actual IP address (e.g., `192.168.1.79`)

To find your server's IP address:
- **Windows**: `ipconfig` in Command Prompt
- **Linux/Mac**: `ifconfig` or `ip addr` in Terminal

## Usage

### Running the System

#### Method 1: Separate Devices (Recommended)

**On Server PC:**
```bash
# Start the server with video display
python main.py server
```

**On Raspberry Pi:**
```bash
# Start the camera client
python main.py pi
```

**On Another Device (optional - for the game interface):**
```bash
# Start the game launcher
python main.py launcher
```

#### Method 2: Camera + Launcher on Same Device

```bash
# Run both camera and launcher together
python main.py both
```

### Game Controls

The game uses **hover-based gesture controls**:

1. **Point your index finger** at any button or interactive element
2. **Hold it steady** for ~0.9 seconds to activate
3. A **circular progress indicator** appears showing activation progress

### Playing Monopoly

1. **Launch the game**: The game launcher will appear
2. **Select Monopoly**: Hover over the "Monopoly" button
3. **Select Players**: 
   - Hover over player slots around the board edges to toggle selection
   - Selected slots will be highlighted in the player's color
   - Minimum 2 players required to start
4. **Start Game**: Hover over the "Start" button (enabled when 2+ players selected)

#### In-Game Controls

Each player panel has three buttons:

- **Roll/End Turn** (Current player only):
  - Shows "Roll" when you can roll dice
  - Shows "End Turn" after rolling (unless you rolled doubles)
  
- **Props** (Properties):
  - View your owned properties
  - Navigate with Prev/Next buttons
  - Shows money and Get Out of Jail cards
  
- **Mortgage**:
  - Manage property mortgages (feature in development)

#### Gameplay

1. **Current player** is highlighted with a gold border
2. **Hover over "Roll"** to roll dice
   - Dice will shake and show result
   - Your token moves automatically
3. **Buying Property**:
   - When you land on an unowned property, a prompt appears
   - Hover "Yes" to buy or "No" to decline
4. **Special Spaces**:
   - **Go**: Collect $200
   - **Jail**: Just visiting (unless sent there)
   - **Free Parking**: Rest space
   - **Go to Jail**: Sent directly to jail
   - **Chance/Community Chest**: Draw cards (feature in development)

#### Rolling Doubles

- If you roll doubles (same number on both dice), you can roll again
- Rolling 3 doubles in a row sends you to jail

## Video Display

When the server runs with `python main.py server`, a video window automatically opens showing:

- **Live camera feed** from the Raspberry Pi
- **Colored circles** around detected fingertips
- **Hand labels** (Left/Right with hand ID)
- **Hand count** in the top-left corner

**Keyboard shortcuts** in video window:
- Press `Q` to close the video window
- Press `ESC` to exit the game

## Project Structure

```
ARPi2/
├── main.py                 # Entry point with mode selection
├── server.py               # WebSocket server + hand tracking processor
├── pi_client.py            # Raspberry Pi camera client
├── launcher.py             # Game launcher application
├── hand_tracking.py        # Hand tracking client module
├── video_display.py        # Video feed display with overlays
├── monopoly.py             # Monopoly game logic
├── ui_components.py        # Reusable UI components
├── ui_elements.py          # UI elements (buttons, player panels)
├── constants.py            # Game constants (properties, cards, etc.)
└── game_launcher.py        # Legacy shim for launcher
```

## Network Architecture

```
┌─────────────────┐         ┌─────────────────┐
│  Raspberry Pi   │         │   Server PC     │
│  (Camera)       │──────▶│  (Processing)   │
│                 │ frames  │                 │
│  pi_client.py   │         │  server.py      │
└─────────────────┘         │  video_display  │
                            └────────┬────────┘
                                     │ hand data
                                     ▼
                            ┌─────────────────┐
                            │  Game Client    │
                            │  (UI)           │
                            │  launcher.py    │
                            └─────────────────┘
```

## Troubleshooting

### Camera not connecting
- Check IP address configuration in all files
- Ensure both devices are on the same network
- Check firewall settings (port 8765 should be open)
- Test connection: `ping YOUR_SERVER_IP`

### No video display
- Video automatically starts when camera connects
- Check terminal for error messages
- Ensure OpenCV is properly installed

### Hand tracking not working
- Ensure good lighting conditions
- Keep hands within camera view
- Camera should have clear view of gesture area
- Try adjusting `min_detection_confidence` in `server.py`

### Game not responding to gestures
- Hold finger steady for full ~0.9 seconds
- Ensure you're pointing with index finger
- Watch for circular progress indicator
- Mouse can be used for testing (cursor appears as black dot)

### Performance issues
- Lower camera resolution in `pi_client.py` (WIDTH/HEIGHT)
- Reduce JPEG_QUALITY in `pi_client.py`
- Decrease FPS in `pi_client.py`
- Close video display if not needed

## Camera Setup

For optimal hand tracking:

1. **Position**: Mount camera overhead, angled down at ~45° toward the table
2. **Height**: 2-3 feet above the play surface
3. **Lighting**: Ensure even, bright lighting (avoid shadows)
4. **Background**: Use a plain, contrasting surface
5. **Coverage**: Camera should see the entire play area

## Development

### Adding New Games

1. Create a new game class similar to `MonopolyGame` in `monopoly.py`
2. Add game button in `launcher.py` (`_create_game_buttons`)
3. Handle game initialization in `launcher.py` (`handle_menu_state`)

### Customizing Hand Tracking

Edit `server.py`:
```python
hands_detector = mp_hands.Hands(
    max_num_hands=8,              # Maximum hands to detect
    min_detection_confidence=0.5,  # Lower = more sensitive
    min_tracking_confidence=0.5    # Lower = more tracking noise
)
```

### Adjusting Hover Time

Edit `HOVER_TIME_THRESHOLD` in:
- `launcher.py` (line 14)
- `ui_elements.py` (line 5)
- `ui_components.py` (line 4)

Default is 0.9 seconds. Lower values = faster activation.

## Known Limitations

- Only index finger is tracked for interactions
- Maximum 8 players supported
- Monopoly game features are still in development:
  - Trading between players
  - Auction system
  - Full Chance/Community Chest implementation
  - House/Hotel building
  - Mortgage system

## License

[Add your license here]

## Contributing

[Add contribution guidelines here]

## Credits

- Hand tracking: MediaPipe by Google
- Game framework: Pygame
- Networking: Websockets